<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø´Ø§Ø´Ø§Øª Ø³Ø¨Ø£ (SabaPost)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .main-card { max-width: 900px; margin: 40px auto; box-shadow: 0 4px 20px rgba(0,0,0,0.1); border: none; border-radius: 20px; overflow: hidden; }
        .header { background: linear-gradient(135deg, #880e4f, #ad1457); color: white; padding: 30px; text-align: center; }
        .nav-tabs .nav-link { color: #880e4f; font-weight: bold; }
        .nav-tabs .nav-link.active { color: #000; border-bottom: 3px solid #880e4f; }
        .btn-primary-custom { background-color: #880e4f; color: white; border: none; padding: 10px 20px; border-radius: 10px; }
        .btn-primary-custom:hover { background-color: #6a0b3d; color: white; }
        .preview-img { width: 80px; height: 50px; object-fit: cover; border-radius: 8px; border: 1px solid #ddd; }
        .status-badge { font-size: 0.8em; padding: 5px 10px; border-radius: 15px; }
        /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ø²Ø± Vercel */
        .vercel-link { color: #000 !important; background-color: #f8f9fa; margin-right: 5px; border: 1px solid #dee2e6; border-bottom: none; }
        .vercel-link:hover { background-color: #e2e6ea; }
    </style>
</head>
<body>

<div class="card main-card">
    <div class="header">
        <h1>ğŸ–¥ï¸ Ù†Ø¸Ø§Ù… Ø´Ø§Ø´Ø§Øª Ø³Ø¨Ø£</h1>
        <p class="mb-0">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© - SabaPost</p>
    </div>
    
    <div class="card-body p-4">
        
        <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="upload-tab" data-bs-toggle="tab" data-bs-target="#upload-pane" type="button">ğŸ“¤ Ø±ÙØ¹ Ù…Ù„Ù (Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²)</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="link-tab" data-bs-toggle="tab" data-bs-target="#link-pane" type="button">ğŸ”— Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ</button>
            </li>
            <li class="nav-item ms-auto"> <a class="nav-link vercel-link" href="https://vercel.com/bashars-projects-d55b853e/~/stores/blob/store_vVFrsAUHJGVb8cWq/browser" target="_blank">
                    ğŸ—‚ï¸ Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙØ§Øª Vercel â†—
                </a>
            </li>
        </ul>

        <div class="tab-content mb-5" id="myTabContent">
            
            <div class="tab-pane fade show active" id="upload-pane" role="tabpanel">
                <div class="row g-3 align-items-end">
                    <div class="col-md-7">
                        <label class="form-label">Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ:</label>
                        <input type="file" id="fileInput" class="form-control" accept="image/*,video/*">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Ø§Ù„Ù…Ø¯Ø© (Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©):</label>
                        <input type="number" id="durationUpload" class="form-control" value="5000">
                    </div>
                    <div class="col-md-2">
                        <button onclick="uploadFile()" class="btn btn-primary-custom w-100" id="btnUpload">Ø±ÙØ¹ ğŸš€</button>
                    </div>
                </div>
                <div class="progress mt-3" id="progressContainer" style="display: none; height: 20px;">
                    <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated bg-success" role="progressbar" style="width: 0%">0%</div>
                </div>
            </div>

            <div class="tab-pane fade" id="link-pane" role="tabpanel">
                <div class="row g-3 align-items-end">
                    <div class="col-md-7">
                        <label class="form-label">Ù„ØµÙ‚ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±:</label>
                        <input type="text" id="urlInput" class="form-control" placeholder="https://example.com/image.jpg">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Ø§Ù„Ù…Ø¯Ø© (Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©):</label>
                        <input type="number" id="durationLink" class="form-control" value="5000">
                    </div>
                    <div class="col-md-2">
                        <button onclick="addLink()" class="btn btn-primary-custom w-100">Ø¥Ø¶Ø§ÙØ© ğŸ’¾</button>
                    </div>
                </div>
            </div>
        </div>

        <hr>

        <h5 class="mb-3 text-secondary">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h5>
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Ø§Ù„Ù…Ø­ØªÙˆÙ‰</th>
                        <th>Ø§Ù„Ù†ÙˆØ¹</th>
                        <th>Ø§Ù„Ù…Ø¯Ø©</th>
                        <th>ØªØ­ÙƒÙ…</th>
                    </tr>
                </thead>
                <tbody id="playlistTable">
                    </tbody>
            </table>
            <div id="loadingMsg" class="text-center text-muted py-3">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©...</div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script type="module">
  // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
  import { getStorage, ref as sRef, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js";

  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ
  const firebaseConfig = {
    apiKey: "AIzaSyCNIsI9vB3sVlXaAScG_U0qcqMBcodqOBI",
    authDomain: "sabapost-c26e3.firebaseapp.com",
    databaseURL: "https://sabapost-c26e3-default-rtdb.firebaseio.com",
    projectId: "sabapost-c26e3",
    storageBucket: "saba-dashboard-f67g-blob", 
    messagingSenderId: "516209922306",
    appId: "1:516209922306:web:dc4f732a642267d872321b",
    measurementId: "G-ZYFDG7N05G"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const storage = getStorage(app);
  const playlistRef = ref(db, 'playlist');

  // --- Ø¯Ø§Ù„Ø© 1: Ø±ÙØ¹ Ù…Ù„Ù Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² ---
  window.uploadFile = function() {
      const fileInput = document.getElementById('fileInput');
      const duration = document.getElementById('durationUpload').value;
      const file = fileInput.files[0];

      if (!file) { alert("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹!"); return; }

      // Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±ÙØ¹
      document.getElementById('progressContainer').style.display = 'block';
      document.getElementById('btnUpload').disabled = true;
      document.getElementById('btnUpload').innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...";

      // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø³Ù… ÙØ±ÙŠØ¯ Ù„Ù„Ù…Ù„Ù
      const storageRef = sRef(storage, 'uploads/' + Date.now() + '_' + file.name);
      const uploadTask = uploadBytesResumable(storageRef, file);

      uploadTask.on('state_changed',
        (snapshot) => {
            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressBar').innerText = Math.round(progress) + '%';
        },
        (error) => {
            alert("âŒ ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹: " + error.message);
            resetUploadForm();
        },
        () => {
            getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {
                saveToDatabase(downloadURL, duration);
                resetUploadForm();
                alert("âœ… ØªÙ… Ø§Ù„Ø±ÙØ¹ ÙˆØ§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!");
            });
        }
      );
  }

  function resetUploadForm() {
      document.getElementById('fileInput').value = '';
      document.getElementById('progressContainer').style.display = 'none';
      document.getElementById('progressBar').style.width = '0%';
      document.getElementById('btnUpload').disabled = false;
      document.getElementById('btnUpload').innerText = "Ø±ÙØ¹ ğŸš€";
  }

  // --- Ø¯Ø§Ù„Ø© 2: Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ ---
  window.addLink = function() {
      const url = document.getElementById('urlInput').value;
      const duration = document.getElementById('durationLink').value;

      if (!url) { alert("âš ï¸ ÙŠØ±Ø¬Ù‰ Ù„ØµÙ‚ Ø§Ù„Ø±Ø§Ø¨Ø·!"); return; }
      
      saveToDatabase(url, duration);
      document.getElementById('urlInput').value = '';
      alert("âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©!");
  }

  // --- Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
  function saveToDatabase(url, duration) {
      const newSlideRef = push(playlistRef);
      set(newSlideRef, {
          imageUrl: url,
          duration: parseInt(duration)
      });
  }

  // --- Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø°Ù ---
  window.deleteSlide = function(key) {
      if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±ØŸ")) {
          remove(ref(db, 'playlist/' + key));
      }
  }

  // --- Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Realtime) ---
  onValue(playlistRef, (snapshot) => {
      const tableBody = document.getElementById('playlistTable');
      const loadingMsg = document.getElementById('loadingMsg');
      tableBody.innerHTML = "";

      if (snapshot.exists()) {
          loadingMsg.style.display = "none";
          snapshot.forEach((childSnapshot) => {
              const key = childSnapshot.key;
              const data = childSnapshot.val();
              const isVideo = data.imageUrl.includes(".mp4") || data.imageUrl.includes("video") || data.imageUrl.includes("alt=media");
              
              const row = `
                <tr>
                    <td>
                        ${isVideo ? 
                          '<span class="badge bg-dark">ğŸ¥ ÙÙŠØ¯ÙŠÙˆ</span>' : 
                          `<a href="${data.imageUrl}" target="_blank"><img src="${data.imageUrl}" class="preview-img"></a>`
                        }
                    </td>
                    <td>${isVideo ? 'ÙÙŠØ¯ÙŠÙˆ' : 'ØµÙˆØ±Ø©'}</td>
                    <td>${data.duration} ms</td>
                    <td>
                        <button onclick="deleteSlide('${key}')" class="btn btn-sm btn-outline-danger">Ø­Ø°Ù ğŸ—‘ï¸</button>
                    </td>
                </tr>
              `;
              tableBody.innerHTML += row;
          });
      } else {
          loadingMsg.innerText = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø­Ø§Ù„ÙŠØ§Ù‹... Ø£Ø¶Ù Ø´ÙŠØ¦Ø§Ù‹! â•";
          loadingMsg.style.display = "block";
      }
  });
</script>

</body>
</html>